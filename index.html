<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma DDP</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        /* Animaciones */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        .loading-spinner { animation: spin 1s linear infinite; }
        .modal-overlay { animation: fadeIn 0.2s ease; }
        .notification-slide { animation: slideIn 0.3s ease; }
        
        /* Drag & Drop Styling */
        .project-card { transition: all 0.2s ease; cursor: grab; user-select: none; }
        .project-card:active { cursor: grabbing; }
        .project-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .drop-zone { min-height: 200px; transition: background-color 0.2s; }
        .drop-zone.drag-over { background-color: #eff6ff; border: 2px dashed #3b82f6; }
        
        /* Gantt Grid Pattern */
        .bg-grid-pattern {
            background-image: linear-gradient(to right, #e5e7eb 1px, transparent 1px);
            background-size: 120px 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // --- CONFIGURACI√ìN ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwDNDbWX2X0E5WL1hh93I86RJ5ErarK9J2yd3q7dUdhoy4OSbkQBcQvtMD3j6Jm3ZKC4g/exec';
        
        const ESTADOS = {
            CREADO: { label: "CREADO", color: "bg-gray-500" },
            EN_PROCESO: { label: "EN PROCESO", color: "bg-blue-500" },
            TEJIDO: { label: "TEJIDO", color: "bg-indigo-500" },
            FINALIZADO: { label: "FINALIZADO", color: "bg-green-500" },
            ANULADO: { label: "ANULADO", color: "bg-red-500" }
        };

        const INITIAL_DATA = [
            { id: '1', nombre: 'BASE SHORT ROSADO', cliente: 'WOALLANCE', estado: 'TEJIDO', proceso: 'Tejido', hiloUrdimbre: '40/1 Tanguis', fechaProgramada: null },
            { id: '2', nombre: 'CUADROS VICHY AZUL', cliente: 'GAP', estado: 'EN PROCESO', proceso: 'Ficha t√©cnica', hiloUrdimbre: '50/1 Poly/Alg', fechaProgramada: null },
        ];

        // --- API SERVICE ---
        class GoogleSheetsAPI {
            constructor(baseUrl) { this.baseUrl = baseUrl; }
            async request(action, data = {}) {
                try {
                    // En desarrollo local esto fallar√° por CORS si no es Apps Script real, usamos mock
                    if (window.location.hostname === 'localhost') throw new Error("Local dev");
                    
                    const response = await fetch(this.baseUrl, {
                        method: 'POST',
                        body: JSON.stringify({ action, ...data })
                    });
                    const result = await response.json();
                    return result;
                } catch (error) {
                    console.warn("API Error/Mock mode:", error);
                    return { success: false, error: error.toString() };
                }
            }
            async getProjects() { return this.request('getProjects'); }
            async createProject(project) { return this.request('createProject', { project }); }
            async updateProject(id, project) { return this.request('updateProject', { id, project }); }
            async deleteProject(id) { return this.request('deleteProject', { id }); }
        }
        const api = new GoogleSheetsAPI(GOOGLE_SCRIPT_URL);

        // --- COMPONENTES ---

        const Notification = ({ notification, setNotification }) => {
            useEffect(() => { const t = setTimeout(() => setNotification(null), 3000); return () => clearTimeout(t); }, []);
            const color = notification.type === 'success' ? 'bg-green-500' : 'bg-blue-600';
            return <div className={`fixed top-20 right-4 ${color} text-white px-6 py-3 rounded shadow-lg z-50 notification-slide`}>{notification.message}</div>;
        };

        // 1. DASHBOARD RESTAURADO
        const DashboardView = ({ projects }) => {
            const stats = useMemo(() => {
                const total = projects.length;
                const enProceso = projects.filter(p => p.estado === 'EN PROCESO').length;
                const tejido = projects.filter(p => p.estado === 'TEJIDO').length;
                const finalizado = projects.filter(p => p.estado === 'FINALIZADO').length;
                return { total, enProceso, tejido, finalizado };
            }, [projects]);

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 animate-fadeIn">
                    <div className="bg-white p-6 rounded-lg shadow border-l-4 border-gray-500">
                        <h3 className="text-gray-500 text-sm font-bold uppercase">Total Proyectos</h3>
                        <p className="text-3xl font-bold text-gray-800">{stats.total}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
                        <h3 className="text-gray-500 text-sm font-bold uppercase">En Proceso</h3>
                        <p className="text-3xl font-bold text-blue-600">{stats.enProceso}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow border-l-4 border-indigo-500">
                        <h3 className="text-gray-500 text-sm font-bold uppercase">En Tejedur√≠a</h3>
                        <p className="text-3xl font-bold text-indigo-600">{stats.tejido}</p>
                    </div>
                    <div className="bg-white p-6 rounded-lg shadow border-l-4 border-green-500">
                        <h3 className="text-gray-500 text-sm font-bold uppercase">Finalizados</h3>
                        <p className="text-3xl font-bold text-green-600">{stats.finalizado}</p>
                    </div>
                </div>
            );
        };

        // 2. KANBAN RESTAURADO
        const KanbanView = ({ projects, onUpdateStatus, onEdit }) => {
            const handleDragStart = (e, id) => e.dataTransfer.setData("id", id);
            const handleDragOver = (e) => e.preventDefault();
            const handleDrop = (e, status) => {
                const id = e.dataTransfer.getData("id");
                onUpdateStatus(id, status);
            };

            return (
                <div className="flex gap-4 overflow-x-auto pb-4 h-full animate-fadeIn">
                    {Object.entries(ESTADOS).map(([key, config]) => (
                        <div key={key} className="flex-shrink-0 w-80 flex flex-col h-full">
                            <div className={`${config.color} text-white px-4 py-2 rounded-t-lg font-bold text-sm flex justify-between`}>
                                {config.label}
                                <span className="bg-white bg-opacity-20 px-2 rounded-full text-xs py-0.5">
                                    {projects.filter(p => p.estado === config.label).length}
                                </span>
                            </div>
                            <div 
                                className="bg-gray-100 p-2 rounded-b-lg flex-1 overflow-y-auto drop-zone border border-gray-200"
                                onDragOver={handleDragOver}
                                onDrop={(e) => handleDrop(e, config.label)}
                            >
                                {projects.filter(p => p.estado === config.label).map(p => (
                                    <div key={p.id} draggable onDragStart={(e) => handleDragStart(e, p.id)}
                                         onClick={() => onEdit(p)}
                                         className="bg-white p-3 mb-2 rounded shadow-sm project-card border-l-2 border-transparent hover:border-blue-500">
                                        <div className="font-bold text-gray-800 text-sm">{p.nombre}</div>
                                        <div className="text-xs text-gray-500 flex justify-between mt-1">
                                            <span><i className="fas fa-user mr-1"></i>{p.cliente}</span>
                                            <span>{p.proceso}</span>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        // 3. TABLA RESTAURADA
        const TableView = ({ projects, onEdit, onDelete }) => (
            <div className="bg-white rounded-lg shadow overflow-hidden animate-fadeIn">
                <table className="w-full text-sm text-left">
                    <thead className="bg-gray-50 text-gray-700 font-bold uppercase border-b">
                        <tr>
                            <th className="px-6 py-3">Proyecto / Dise√±o</th>
                            <th className="px-6 py-3">Cliente</th>
                            <th className="px-6 py-3">Estado</th>
                            <th className="px-6 py-3">Hilado (Urd)</th>
                            <th className="px-6 py-3">Acciones</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-gray-200">
                        {projects.map(p => (
                            <tr key={p.id} className="hover:bg-gray-50">
                                <td className="px-6 py-3">
                                    <div className="font-bold text-gray-900">{p.nombre}</div>
                                    <div className="text-xs text-gray-500">{p.articuloBase || 'Sin art√≠culo'}</div>
                                </td>
                                <td className="px-6 py-3">{p.cliente}</td>
                                <td className="px-6 py-3">
                                    <span className={`px-2 py-1 rounded-full text-xs text-white ${Object.values(ESTADOS).find(e => e.label === p.estado)?.color || 'bg-gray-400'}`}>
                                        {p.estado}
                                    </span>
                                </td>
                                <td className="px-6 py-3 text-gray-500">{p.hiloUrdimbre || '-'}</td>
                                <td className="px-6 py-3 flex gap-3">
                                    <button onClick={() => onEdit(p)} className="text-blue-600 hover:text-blue-800"><i className="fas fa-edit"></i></button>
                                    <button onClick={() => onDelete(p.id)} className="text-red-600 hover:text-red-800"><i className="fas fa-trash"></i></button>
                                </td>
                            </tr>
                        ))}
                        {projects.length === 0 && <tr><td colSpan="5" className="text-center py-8 text-gray-400">No se encontraron proyectos</td></tr>}
                    </tbody>
                </table>
            </div>
        );

        // 4. GANTT HANDLOOM (1 SOLO TELAR) - NUEVO
        const HandloomView = ({ projects, onUpdateProject, showNotification }) => {
            const daysToShow = 14;
            const cellWidth = 120;
            const today = new Date();
            today.setHours(0,0,0,0);
            
            const dates = useMemo(() => Array.from({length: daysToShow}).map((_, i) => {
                const d = new Date(today); d.setDate(today.getDate() + i); return d;
            }), []);

            const backlogProjects = projects.filter(p => 
                (p.estado === 'TEJIDO' || p.estado === 'EN PROCESO' || p.proceso === 'Tejido') && !p.fechaProgramada
            );

            const scheduledProjects = projects.filter(p => p.fechaProgramada).map(p => {
                const start = new Date(p.fechaProgramada); start.setHours(0,0,0,0);
                const diffDays = Math.floor((start - today) / (1000 * 60 * 60 * 24));
                return { ...p, offset: diffDays * cellWidth, duration: 2 }; 
            });

            const handleDropOnDay = (e, date) => {
                e.preventDefault();
                const projectId = e.dataTransfer.getData('projectId');
                const project = projects.find(p => p.id.toString() === projectId);
                if (project) {
                    onUpdateProject({ ...project, fechaProgramada: date.toISOString(), estado: 'TEJIDO', proceso: 'Tejido' });
                    showNotification(`üìÖ ${project.nombre} programado`, 'success');
                }
            };

            const handleRemoveSchedule = (p) => {
                onUpdateProject({ ...p, fechaProgramada: null });
                showNotification(`‚Ü©Ô∏è ${p.nombre} devuelto a cola`, 'info');
            };

            return (
                <div className="flex h-[calc(100vh-180px)] bg-gray-100 border-t border-gray-300 animate-fadeIn">
                    {/* Cola */}
                    <div className="w-72 bg-white border-r flex flex-col shadow-md z-10">
                        <div className="p-3 bg-slate-800 text-white flex justify-between items-center">
                            <h3 className="font-bold text-sm uppercase"><i className="fas fa-list mr-2"></i>Cola de Pedidos</h3>
                            <span className="bg-blue-600 text-xs px-2 rounded-full">{backlogProjects.length}</span>
                        </div>
                        <div className="flex-1 overflow-y-auto p-2 space-y-2 bg-gray-50">
                            {backlogProjects.map(p => (
                                <div key={p.id} draggable onDragStart={e => e.dataTransfer.setData('projectId', p.id)}
                                     className="bg-white p-3 rounded border-l-4 border-blue-500 shadow-sm cursor-move hover:shadow-md">
                                    <div className="font-bold text-sm text-gray-800">{p.nombre}</div>
                                    <div className="text-xs text-gray-500">{p.cliente}</div>
                                    {p.hiloUrdimbre && <div className="mt-1 text-[10px] bg-gray-100 px-1 rounded inline-block">{p.hiloUrdimbre}</div>}
                                </div>
                            ))}
                            {backlogProjects.length === 0 && <div className="text-center text-gray-400 mt-10 text-xs">Sin pendientes de tejido</div>}
                        </div>
                    </div>
                    {/* Gantt */}
                    <div className="flex-1 flex flex-col bg-white overflow-x-auto">
                        <div className="flex h-10 border-b bg-gray-50 min-w-max sticky top-0 z-20">
                            <div className="w-40 flex-shrink-0 bg-slate-800 text-white flex items-center justify-center text-xs font-bold">HANDLOOM #1</div>
                            {dates.map((d, i) => (
                                <div key={i} className={`flex-shrink-0 border-r flex flex-col items-center justify-center text-xs ${d.getDay()===0||d.getDay()===6?'bg-gray-200':''}`} style={{width: cellWidth}}>
                                    <span className="font-bold">{d.getDate()}</span>
                                    <span className="text-[9px]">{d.toLocaleDateString('es-ES',{weekday:'short'})}</span>
                                </div>
                            ))}
                        </div>
                        <div className="flex-1 relative min-w-max bg-grid-pattern">
                            <div className="flex h-full">
                                <div className="w-40 flex-shrink-0 bg-white border-r flex flex-col items-center pt-4 sticky left-0 z-10 shadow-sm">
                                    <div className="font-bold text-blue-900">TELAR √öNICO</div>
                                    <div className="text-xs text-green-600 mt-1">‚óè Operativo</div>
                                </div>
                                <div className="relative flex h-full">
                                    {dates.map((d, i) => (
                                        <div key={i} onDragOver={e => e.preventDefault()} onDrop={e => handleDropOnDay(e, d)}
                                             className="h-full border-r border-transparent hover:bg-blue-50 transition-colors" style={{width: cellWidth}}></div>
                                    ))}
                                    {scheduledProjects.map(p => {
                                        if (p.offset < 0 || p.offset > daysToShow * cellWidth) return null;
                                        return (
                                            <div key={p.id} className="absolute top-4 h-24 rounded bg-blue-600 text-white p-2 shadow-md cursor-pointer hover:bg-blue-700 z-10"
                                                 style={{left: p.offset, width: (p.duration * cellWidth) - 4, marginLeft: 2}}
                                                 onDoubleClick={() => handleRemoveSchedule(p)}>
                                                <div className="font-bold text-xs truncate">{p.cliente}</div>
                                                <div className="font-bold text-sm mt-1 leading-tight truncate">{p.nombre}</div>
                                                <div className="text-[10px] mt-2 opacity-80 truncate">{p.hiloUrdimbre || 'N/A'}</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 5. MODAL DETALLADO - NUEVO
        const ProjectModal = ({ selectedProject, setShowModal, saveProject }) => {
            const [formData, setFormData] = useState(selectedProject || {
                area: "COMERCIAL", solicitante: "", cliente: "", fechaRequerida: new Date().toISOString().split('T')[0],
                usoFinal: "Camisa", acabado: "", acabadoPrenda: "", articuloBase: "", nombre: "", combinacion: "",
                anchoAcabado: "150", pesoAcabado: "", hiloUrdimbre: "", hiloTrama: "", composicion: "",
                estado: "CREADO", proceso: "Ficha t√©cnica", observaciones: ""
            });
            const handleChange = (field, value) => setFormData(prev => ({ ...prev, [field]: value }));

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 modal-overlay" onClick={(e) => e.target === e.currentTarget && setShowModal(false)}>
                    <div className="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="sticky top-0 bg-blue-800 text-white px-6 py-4 flex justify-between items-center z-10">
                            <h2 className="text-xl font-bold"><i className="fas fa-file-signature mr-2"></i>{selectedProject ? 'Editar Solicitud' : 'Nueva Solicitud'}</h2>
                            <button onClick={() => setShowModal(false)} className="text-white hover:text-gray-200"><i className="fas fa-times text-lg"></i></button>
                        </div>
                        <form onSubmit={(e) => { e.preventDefault(); saveProject(formData); }} className="p-6 bg-gray-50 space-y-4">
                            <div className="bg-white p-4 rounded shadow border">
                                <h3 className="text-sm font-bold text-blue-800 border-b pb-2 mb-3">DATOS GENERALES</h3>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div><label className="text-xs font-bold text-gray-500">√Årea</label><select className="w-full border rounded p-2 mt-1" value={formData.area} onChange={e=>handleChange('area', e.target.value)}><option>COMERCIAL</option><option>DISE√ëO</option><option>PRODUCCI√ìN</option></select></div>
                                    <div><label className="text-xs font-bold text-gray-500">Solicitante</label><input className="w-full border rounded p-2 mt-1" value={formData.solicitante} onChange={e=>handleChange('solicitante', e.target.value)} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Cliente Final *</label><input className="w-full border rounded p-2 mt-1" required value={formData.cliente} onChange={e=>handleChange('cliente', e.target.value)} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">Fecha Req.</label><input type="date" className="w-full border rounded p-2 mt-1" value={formData.fechaRequerida} onChange={e=>handleChange('fechaRequerida', e.target.value)} /></div>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="bg-white p-4 rounded shadow border">
                                    <h3 className="text-sm font-bold text-gray-700 mb-3">Definici√≥n</h3>
                                    <div className="space-y-3">
                                        <div><label className="text-xs block text-gray-500">Uso Final</label><select className="w-full border rounded p-2" value={formData.usoFinal} onChange={e=>handleChange('usoFinal', e.target.value)}><option>Camisa</option><option>Pantal√≥n</option></select></div>
                                        <div><label className="text-xs block text-gray-500">Acabado</label><input className="w-full border rounded p-2" value={formData.acabado} onChange={e=>handleChange('acabado', e.target.value)} /></div>
                                    </div>
                                </div>
                                <div className="md:col-span-2 bg-white p-4 rounded shadow border">
                                    <h3 className="text-sm font-bold text-gray-700 mb-3">Ficha T√©cnica</h3>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold text-blue-600">ART√çCULO BASE</label><input className="w-full border-b-2 border-blue-200 bg-blue-50 p-2" value={formData.articuloBase} onChange={e=>handleChange('articuloBase', e.target.value)} /></div>
                                        <div><label className="text-xs font-bold text-blue-600">NOMBRE DISE√ëO *</label><input className="w-full border-b-2 border-blue-200 bg-blue-50 p-2" required value={formData.nombre} onChange={e=>handleChange('nombre', e.target.value)} /></div>
                                        <div className="grid grid-cols-2 gap-2">
                                            <input type="number" placeholder="Ancho (cm)" className="border rounded p-2" value={formData.anchoAcabado} onChange={e=>handleChange('anchoAcabado', e.target.value)} />
                                            <input type="number" placeholder="Peso (g)" className="border rounded p-2" value={formData.pesoAcabado} onChange={e=>handleChange('pesoAcabado', e.target.value)} />
                                        </div>
                                        <input placeholder="Combinaci√≥n" className="border rounded p-2" value={formData.combinacion} onChange={e=>handleChange('combinacion', e.target.value)} />
                                    </div>
                                </div>
                            </div>
                            <div className="bg-white p-4 rounded shadow border">
                                <h3 className="text-sm font-bold text-gray-700 mb-3">Hilado</h3>
                                <div className="grid grid-cols-2 gap-4">
                                    <div><label className="text-xs font-bold text-gray-500">URDIMBRE</label><input className="w-full border-b p-2" placeholder="Ej: 40/1" value={formData.hiloUrdimbre} onChange={e=>handleChange('hiloUrdimbre', e.target.value)} /></div>
                                    <div><label className="text-xs font-bold text-gray-500">TRAMA</label><input className="w-full border-b p-2" placeholder="Ej: 50/1" value={formData.hiloTrama} onChange={e=>handleChange('hiloTrama', e.target.value)} /></div>
                                </div>
                            </div>
                            <div className="flex justify-end gap-3 pt-4 border-t">
                                <button type="button" onClick={() => setShowModal(false)} className="px-6 py-2 border rounded bg-white hover:bg-gray-50">Cancelar</button>
                                <button type="submit" className="px-8 py-2 bg-blue-700 text-white font-bold rounded hover:bg-blue-800 shadow"><i className="fas fa-save mr-2"></i>Guardar</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        function App() {
            const [projects, setProjects] = useState(INITIAL_DATA);
            const [view, setView] = useState('dashboard');
            const [showModal, setShowModal] = useState(false);
            const [selectedProject, setSelectedProject] = useState(null);
            const [notification, setNotification] = useState(null);
            const [loading, setLoading] = useState(true);
            
            // Filtros
            const [search, setSearch] = useState("");
            const [filterClient, setFilterClient] = useState("");
            const [filterStatus, setFilterStatus] = useState("");

            const showNotif = (msg, type) => setNotification({message: msg, type});

            useEffect(() => {
                api.getProjects().then(res => {
                    if(res.projects) setProjects(res.projects);
                    setLoading(false);
                }).catch(() => setLoading(false));
            }, []);

            // L√≥gica de filtrado global
            const filteredProjects = useMemo(() => {
                return projects.filter(p => {
                    const matchSearch = !search || p.nombre.toLowerCase().includes(search.toLowerCase()) || p.cliente.toLowerCase().includes(search.toLowerCase());
                    const matchClient = !filterClient || p.cliente === filterClient;
                    const matchStatus = !filterStatus || p.estado === filterStatus;
                    return matchSearch && matchClient && matchStatus;
                });
            }, [projects, search, filterClient, filterStatus]);

            const saveProject = async (data) => {
                const isNew = !data.id;
                const tempId = isNew ? Date.now().toString() : data.id;
                const newP = { ...data, id: tempId };
                setProjects(prev => isNew ? [...prev, newP] : prev.map(p => p.id === tempId ? newP : p));
                setShowModal(false);
                try {
                    if (isNew) await api.createProject(data); else await api.updateProject(data.id, data);
                    showNotif('Guardado exitoso', 'success');
                    api.getProjects().then(res => { if(res.projects) setProjects(res.projects); });
                } catch (e) { showNotif('Error al guardar', 'error'); }
            };

            const deleteProject = async (id) => {
                if(!confirm("¬øEliminar proyecto?")) return;
                setProjects(prev => prev.filter(p => p.id !== id));
                await api.deleteProject(id);
                showNotif('Proyecto eliminado', 'success');
            };

            const updateStatus = async (id, status) => {
                const project = projects.find(p => p.id === id);
                if (project && project.estado !== status) {
                    const updated = { ...project, estado: status };
                    setProjects(prev => prev.map(p => p.id === id ? updated : p));
                    await api.updateProject(id, { estado: status });
                    showNotif(`Movido a ${status}`, 'success');
                }
            };

            // Listas √∫nicas para filtros
            const clientes = [...new Set(projects.map(p => p.cliente))];

            return (
                <div className="min-h-screen bg-gray-50 text-gray-800">
                    {notification && <Notification notification={notification} setNotification={setNotification} />}
                    
                    {/* HEADER */}
                    <header className="bg-white shadow-sm border-b px-6 py-3 flex justify-between items-center sticky top-0 z-30">
                        <div className="flex items-center gap-3">
                            <i className="fas fa-layer-group text-2xl text-blue-600"></i>
                            <h1 className="text-xl font-bold tracking-tight">Plataforma DDP</h1>
                        </div>
                        <button onClick={() => { setSelectedProject(null); setShowModal(true); }} 
                                className="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-5 py-2 rounded-lg font-medium shadow hover:from-blue-700 hover:to-blue-800 transition-all flex items-center gap-2">
                            <i className="fas fa-plus"></i> Nuevo
                        </button>
                    </header>

                    {/* NAV & FILTERS */}
                    <div className="bg-white border-b px-6 py-3 shadow-sm flex flex-col md:flex-row justify-between gap-4 items-center">
                        <div className="flex space-x-1 bg-gray-100 p-1 rounded-lg">
                            {[
                                {id: 'dashboard', label: 'Dashboard', icon: 'chart-pie'},
                                {id: 'kanban', label: 'Kanban', icon: 'columns'},
                                {id: 'handloom', label: 'Handloom', icon: 'stream'},
                                {id: 'table', label: 'Tabla', icon: 'table'}
                            ].map(tab => (
                                <button key={tab.id} onClick={() => setView(tab.id)} 
                                        className={`px-4 py-2 rounded-md text-sm font-medium transition-all flex items-center gap-2 ${view === tab.id ? 'bg-white text-blue-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>
                                    <i className={`fas fa-${tab.icon}`}></i> {tab.label}
                                </button>
                            ))}
                        </div>
                        {/* Filtros (Ocultos en Gantt para espacio) */}
                        {view !== 'handloom' && (
                            <div className="flex gap-2 w-full md:w-auto">
                                <input type="text" placeholder="Buscar..." className="border rounded px-3 py-1.5 text-sm w-full md:w-48" value={search} onChange={e=>setSearch(e.target.value)} />
                                <select className="border rounded px-3 py-1.5 text-sm" value={filterClient} onChange={e=>setFilterClient(e.target.value)}>
                                    <option value="">Todos Clientes</option>
                                    {clientes.map(c => <option key={c} value={c}>{c}</option>)}
                                </select>
                            </div>
                        )}
                    </div>

                    {/* MAIN CONTENT */}
                    <main className="p-6">
                        {loading ? (
                            <div className="flex flex-col items-center justify-center h-64 text-gray-400">
                                <i className="fas fa-circle-notch fa-spin text-4xl text-blue-500 mb-3"></i>
                                <p>Cargando sistema...</p>
                            </div>
                        ) : (
                            <>
                                {view === 'dashboard' && <DashboardView projects={projects} />}
                                {view === 'kanban' && <KanbanView projects={filteredProjects} onUpdateStatus={updateStatus} onEdit={(p)=>{setSelectedProject(p); setShowModal(true)}} />}
                                {view === 'table' && <TableView projects={filteredProjects} onEdit={(p)=>{setSelectedProject(p); setShowModal(true)}} onDelete={deleteProject} />}
                                {view === 'handloom' && <HandloomView projects={projects} onUpdateProject={saveProject} showNotification={showNotif} />}
                            </>
                        )}
                    </main>

                    {showModal && <ProjectModal selectedProject={selectedProject} setShowModal={setShowModal} saveProject={saveProject} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
